---
layout:     post
title:      计算机网络笔记
subtitle:   网络层传输
date:       2019-11-05
author:     Shawn
header-img: img/post-bg-ioses.jpg
catalog: true
tags:
    - 计算机网络






---

# 计算机网络笔记：网络层传输

## 一、网络层传输过程

每个网络都有自己的网络号和子网掩码，假设有如下一个模型：

![微信图片_20191105170940.jpg](https://i.loli.net/2019/11/05/VzjY8uHElkbdL5G.jpg)

现在源主机H1要想目的主机H2发送分组，发送时当然有一个目的ip地址，这个ip地址即为H2的ip地址。首先，将目的ip地址与现在分组所在的网络的子网掩码进行与运算，看看H2是不是就在这个网络中，与运算后发现结果与当前网络号不同，不在这个网络中，所以将这个分组交给子网上的默认路由器R1，让R1进行转发。

路由器中会有一个路由表，路由表中包含目的网络地址、子网掩码、下一跳等信息。这里的目的网络地址与子网掩码一一对应，是指这个路由器所能到达的其他网络地址（或许不是最后一级的那个网络，这就是这里掩码的作用）。将H2的地址与每一行的子网掩码做与运算，并与这个目的网络地址做比对，如果相同，那么就说明H2是在这个网络中，那么路由器R1就执行下一跳，到达下一个路由器。（注意此处执行完下一跳的下一个路由器不一定就是最后一个路由器）这里的下一跳可能是路由器ip，也可能是一个接口，如果是接口的话，那么就已经到达了目的的网络，如果是路由器，那么就继续查询路由表，继续跳转。

现在假设分组已经传输到最后的那个网络。我们知道数据传输实际上是需要硬件地址，所以在传输过程中（无论是路由器间的传输，还是最后路由器给目的主机传输，抑或是两个主机间的传输）需要使用到ARP协议。ARP协议的用途是将网络层使用的ip地址解析出在数据链路层使用的硬件地址。解析出来后，便将分组传输到目的物理地址去。

## 二、ARP协议具体工作原理

每一台主机都有一个ARP高度缓存，里面有本局域网上的各主机和路由器的ip地址到硬件地址的映射表。当A要向B发送ip数据报时，A会先在自己的ARP高速缓存中查找B的ip所对应的硬件地址，如果查到了，那么就把这个硬件地址写入MAC帧，然后通过局域网的数据链路层，将该MAC帧发往此硬件地址。如果没查到，那么A会运行ARP进程，具体过程如下：

![微信图片_20191105170947.jpg](https://i.loli.net/2019/11/05/yqhSfPQjx6wViDC.jpg)

![微信图片_20191105170952.jpg](https://i.loli.net/2019/11/05/Dq1EIOflvLMWtcy.jpg)

## 三、为什么需要ip地址

**既然网链路上传送的帧最终是按照硬件地址找到目的主机的，那为什么要使用抽象的ip地址呢？为什么不直接使用硬件地址进行通信呢？**

由于全世界存在着各式各样的网络，他们使用不同的硬件地址。要使用这些异构网络能够互相通信就必须进行非常复杂的硬件地址转换工作，因此由用户或用户主机来完成这项工作是几乎不可能的事。但ip地址编制将这个复杂的问题解决了。连接到互联网的主机只需要各自拥有一个唯一的ip地址，ARP自动将ip地址映射到硬件地址，这一过程事由计算机软件自动进行的。给了用户极大的便利。